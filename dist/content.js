console.log("CONTENT SCRIPT LOADED");function v(n,i,g){const w=Math.round(g/1e3),d={title:n,url:i,timeWatched:w,watchedAt:new Date().toISOString()};chrome.storage.local.get(["watchHistory"],m=>{const u=m.watchHistory||[];u.push(d),chrome.storage.local.set({watchHistory:u},()=>{console.log("Video entry saved:",d)})})}let e=null,t=null,a=0;function f(){if(e=document.querySelector("video"),!e){console.log("Video element not found");return}console.log("Tracking video:",document.title),t=null,a=0,e.addEventListener("play",s),e.addEventListener("pause",h),window.addEventListener("beforeunload",c),!e.paused&&!e.ended&&(console.log("Video is already being played"),s())}function c(){t&&(a+=Date.now()-t,t=null),e&&(v(document.title,location.href,a),e.removeEventListener("play",s),e.removeEventListener("pause",h)),e=null,a=0}function s(){t||(t=Date.now(),console.log("Video started"))}function h(){t&&(a+=Date.now()-t,t=null,console.log("Video paused"))}let l=r(),o=!1;function r(){return new URLSearchParams(location.search).get("v")}function p(){const n=location.pathname,i=r();n==="/watch"||n==="/shorts"?(!o||i!==l)&&(o&&(console.log("Switching to new video"),c()),l=i,setTimeout(f,1e3),o=!0):o&&(console.log("Left video page"),c(),o=!1,l=null)}window.addEventListener("load",()=>{location.pathname==="/watch"&&(l=r(),setTimeout(f,1e3),o=!0)});setInterval(p,500);
