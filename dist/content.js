function p(e,n,r,v){const w=Math.round(r/1e3),h={title:e,url:n,channelName:v,timeWatched:w,watchedAt:new Date().toISOString()};chrome.storage.local.get(["watchHistory"],y=>{const m=y.watchHistory||[];m.push(h),chrome.storage.local.set({watchHistory:m},()=>{console.log("Video entry saved:",h)})})}let t=null,o=null,a=0,c="";function f(){t=document.querySelector("video");let e=document.querySelector("ytd-channel-name a");if(c=e==null?void 0:e.textContent.trim(),!t){console.log("Video element not found");return}let n=document.querySelectorAll("div#title")[2],r=n?n.textContent.trim():"";console.log("Tracking video:",r),console.log("Channel name: ",c),o=null,a=0,t.addEventListener("play",d),t.addEventListener("pause",g),window.addEventListener("beforeunload",s),!t.paused&&!t.ended&&(console.log("Video is already being played"),d())}function s(){if(o&&(a+=Date.now()-o,o=null),t){let e=document.querySelectorAll("div#title")[2];e&&e.textContent.trim(),p(document.title,location.href,a,c),t.removeEventListener("play",d),t.removeEventListener("pause",g)}t=null,c="",a=0}function d(){o||(o=Date.now(),console.log("Video started"))}function g(){o&&(a+=Date.now()-o,o=null,console.log("Video paused"))}console.log("CONTENT SCRIPT LOADED");let i=u(),l=!1;function u(){return new URLSearchParams(location.search).get("v")}function T(){const e=location.pathname,n=u();e==="/watch"||e==="/shorts"?(!l||n!==i)&&(l&&(console.log("Switching to new video"),s()),i=n,setTimeout(f,1e3),l=!0):l&&(console.log("Left video page"),s(),l=!1,i=null)}window.addEventListener("load",()=>{location.pathname==="/watch"&&(i=u(),setTimeout(f,1e3),l=!0)});setInterval(T,500);
